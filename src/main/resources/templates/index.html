<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header}"></head>
<body>

<!-- Navigation -->
<nav class="navbar navbar-dark bg-dark navbar-expand-lg">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">
            <i class="bi bi-bank2"></i> ACL Pattern Demo
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/">Demo</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/documentation">Documentation</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/h2-console" target="_blank">H2 Console</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Hero Section -->
<div class="bg-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold">Anti-Corruption Layer Pattern</h1>
                <p class="lead">Database Migration Without Breaking Legacy Systems</p>
                <p class="mb-0">
                    <i class="bi bi-arrow-right-circle"></i> Query new DB first, fallback to legacy
                    <br>
                    <i class="bi bi-arrow-right-circle"></i> Dual-write to both databases
                    <br>
                    <i class="bi bi-arrow-right-circle"></i> Zero downtime migration
                </p>
            </div>
            <div class="col-lg-4 text-center">
                <i class="bi bi-diagram-3 display-1"></i>
            </div>
        </div>
    </div>
</div>

<!-- Migration Stats Dashboard -->
<div class="container my-5">
    <div class="row g-4">
        <div class="col-md-3">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <i class="bi bi-database-fill-down text-warning fs-1"></i>
                    <h3 class="mt-3" th:text="${stats.legacyRecords}">0</h3>
                    <p class="text-muted mb-0">Legacy DB Records</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-success">
                <div class="card-body text-center">
                    <i class="bi bi-database-fill-up text-success fs-1"></i>
                    <h3 class="mt-3" th:text="${stats.modernRecords}">0</h3>
                    <p class="text-muted mb-0">Modern DB Records</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-info">
                <div class="card-body text-center">
                    <i class="bi bi-pie-chart-fill text-info fs-1"></i>
                    <h3 class="mt-3" th:text="${stats.migrationPercentage + '%'}">0%</h3>
                    <p class="text-muted mb-0">Migration Progress</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <i class="bi bi-activity text-primary fs-1"></i>
                    <h3 class="mt-3" th:text="${stats.status}">STARTED</h3>
                    <p class="text-muted mb-0">System Status</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ACL Demo Section -->
<div class="container my-5">
    <div class="row">
        
        <!-- Search Customer (Read Operation) -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-search"></i> Query Customer (ACL Read)</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">
                        Test the smart query logic: searches New DB first, falls back to Legacy DB
                    </p>
                    
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="searchId" 
                               placeholder="Enter Customer ID (e.g., LEG001 or NEW001)">
                        <button class="btn btn-primary" onclick="searchCustomer()">
                            <i class="bi bi-search"></i> Search
                        </button>
                    </div>
                    
                    <!-- Query Flow Visualization -->
                    <div id="queryFlow" class="alert alert-light d-none">
                        <h6 class="fw-bold">Query Flow:</h6>
                        <div id="step1" class="mb-2">
                            <i class="bi bi-circle"></i> Step 1: Check New DB...
                        </div>
                        <div id="step2" class="mb-2 d-none">
                            <i class="bi bi-circle"></i> Step 2: Fallback to Legacy DB...
                        </div>
                        <div id="step3" class="d-none">
                            <i class="bi bi-circle"></i> Step 3: Transform to new format...
                        </div>
                    </div>
                    
                    <!-- Search Result -->
                    <div id="searchResult" class="d-none"></div>
                </div>
            </div>
        </div>
        <!-- Create Customer (Write Operation) -->
		<div class="col-lg-6 mb-4">
		    <div class="card h-100 shadow-sm">
		        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
		            <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Create Customer (ACL Write)</h5>
		            <button class="btn btn-sm btn-light" onclick="autoFillForm()" type="button">
		                <i class="bi bi-magic"></i> Auto Fill
		            </button>
		        </div>
		        <div class="card-body">
		            <p class="text-muted">
		                Test dual-write: saves to both New and Legacy databases simultaneously
		            </p>
		            
		            <form id="createCustomerForm" onsubmit="createCustomer(event)">
		                <div class="row g-2">
		                    <div class="col-md-6">
		                        <input type="text" class="form-control form-control-sm" 
		                               id="input-name" name="name" placeholder="Full Name" required>
		                    </div>
		                    <div class="col-md-6">
		                        <input type="email" class="form-control form-control-sm" 
		                               id="input-email" name="email" placeholder="Email" required>
		                    </div>
		                    <div class="col-md-6">
		                        <input type="tel" class="form-control form-control-sm" 
		                               id="input-phone" name="phone" placeholder="Phone" required>
		                    </div>
		                    <div class="col-md-6">
		                        <select class="form-select form-select-sm" id="input-accountType" name="accountType">
		                            <option value="SAVINGS">Savings</option>
		                            <option value="CHECKING">Checking</option>
		                            <option value="PREMIUM">Premium</option>
		                        </select>
		                    </div>
		                    <div class="col-12">
		                        <input type="text" class="form-control form-control-sm" 
		                               id="input-street" name="street" placeholder="Street Address" required>
		                    </div>
		                    <div class="col-md-6">
		                        <input type="text" class="form-control form-control-sm" 
		                               id="input-city" name="city" placeholder="City" required>
		                    </div>
		                    <div class="col-md-3">
		                        <input type="text" class="form-control form-control-sm" 
		                               id="input-state" name="state" placeholder="State">
		                    </div>
		                    <div class="col-md-3">
		                        <input type="text" class="form-control form-control-sm" 
		                               id="input-zipCode" name="zipCode" placeholder="ZIP">
		                    </div>
		                </div>
		                
		                <button type="submit" class="btn btn-success w-100 mt-3">
		                    <i class="bi bi-save"></i> Create Customer
		                </button>
		            </form>
		            
		            <!-- Dual Write Status -->
		            <div id="createResult" class="d-none mt-3"></div>
		        </div>
		    </div>
		</div>
    </div>
</div>

<!-- Real-time Activity Log -->
<div class="container my-5">
    <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0"><i class="bi bi-terminal"></i> Real-Time Activity Log</h5>
        </div>
        <div class="card-body bg-dark text-light" style="height: 250px; overflow-y: auto;">
            <div id="activityLog" class="font-monospace small">
                <div class="text-success">[System] ACL Demo ready. Try searching or creating customers!</div>
            </div>
        </div>
    </div>
</div>

<!-- Sample IDs Helper -->
<div class="container my-4">
    <div class="alert alert-info">
        <h6 class="fw-bold"><i class="bi bi-info-circle"></i> Sample Customer IDs to Try:</h6>
        <div class="row">
            <div class="col-md-6">
                <strong>Legacy Database:</strong>
                <code class="ms-2">LEG001</code>
                <code class="ms-2">LEG002</code>
                <code class="ms-2">LEG003</code>
            </div>
            <div class="col-md-6">
                <strong>Modern Database:</strong>
                <code class="ms-2">NEW001</code>
                <code class="ms-2">NEW002</code>
                <code class="ms-2">NEW003</code>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-white py-4 mt-5">
    <div class="container text-center">
        <p class="mb-0">
            <i class="bi bi-github"></i> ACL Pattern Demo | 
            Built with Spring Boot + Thymeleaf
        </p>
    </div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JavaScript -->
<script th:src="@{/js/app.js}"></script>

</body>
</html>